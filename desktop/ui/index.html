<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FaceForge</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="title">FaceForge</div>
        <div class="subtitle">Desktop Orchestrator</div>
      </div>
      
      <nav class="main-menu">
         <div id="menu-status" class="menu-item active">Status</div>
         <div id="menu-settings" class="menu-item">Settings</div>
         <div id="menu-logs" class="menu-item">Logs</div>
         <div class="separator" style="width: 1px; background: rgba(255,255,255,0.1); height: 20px; margin: 0 8px;"></div>
         <div id="menu-webui" class="menu-item">Web UI</div>
      </nav>

      <div class="controls">
        <button id="btn-start">Start</button>
        <button id="btn-stop">Stop</button>
        <button id="btn-restart">Restart</button>
        <button id="btn-exit" class="danger">Exit</button>
      </div>
    </header>

    <div id="breadcrumbs" class="breadcrumbs">
       <span id="crumb-text">Home &gt; Status</span>
    </div>

    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="loading-overlay hidden" aria-live="polite" aria-busy="true">
      <div class="loading-card">
        <div class="loading-brand">
          <div class="loading-title">FaceForge</div>
          <div id="loading-subtitle" class="loading-subtitle">Initializing…</div>
        </div>

        <div class="loading-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-label="Loading"></div>

        <div class="loading-steps" aria-hidden="true">
          <div class="loading-step" data-step="config">
            <span class="loading-dot"></span>
            <span class="loading-label">Configuration</span>
          </div>
          <div class="loading-step" data-step="engine">
            <span class="loading-dot"></span>
            <span class="loading-label">Engine</span>
          </div>
          <div class="loading-step" data-step="ready">
            <span class="loading-dot"></span>
            <span class="loading-label">Ready</span>
          </div>
        </div>

        <div class="loading-lines" aria-hidden="true">
          <div class="loading-line"></div>
          <div class="loading-line"></div>
          <div class="loading-line"></div>
        </div>

        <div id="loading-detail" class="loading-detail">Contacting desktop backend</div>
      </div>
    </div>

    <section id="error-banner" class="banner hidden">
      <div class="banner-text">
        <div id="error-title" class="banner-title"></div>
        <div id="error-detail" class="banner-detail"></div>
      </div>
      <button id="btn-error-dismiss" class="banner-dismiss">Dismiss</button>
    </section>

    <main class="main-content">
      <!-- SETTINGS / WIZARD -->
      <section id="view-settings" class="card view-page hidden">
        <h2>System Settings</h2>
        <p class="muted">Configure local data location and service ports.</p>

        <div class="settings-group">
          <label>
            <div class="label-row">
              <span>Data Directory</span>
              <span class="help-text">Where FaceForge stores database, files, and logs.</span>
            </div>
            <div class="row">
              <input id="setting-home" type="text" placeholder="C:\FaceForge" />
              <button id="btn-browse">Browse…</button>
            </div>
          </label>

          <label>
            <div class="label-row">
              <span>Core Service Port</span>
              <span class="help-text">Localhost port for API and Web UI.</span>
            </div>
            <input id="setting-core-port" type="number" min="1" max="65535" />
          </label>

          <label class="checkbox" title="When enabled, FaceForge Desktop will automatically restart the Core service if it stops unexpectedly.">
            <input id="setting-auto-restart" type="checkbox" />
            <span>Auto-Restart Core</span>
          </label>

          <label class="checkbox" title="When enabled, closing the window or clicking Exit will minimize FaceForge to the system tray instead of quitting. Use the tray menu Exit to fully quit.">
            <input id="setting-minimize-on-exit" type="checkbox" checked />
            <span>Minimize on Exit</span>
          </label>
           
          <!-- Added Log Size Setting -->
          <label>
             <div class="label-row">
                <span>Max Log Size (MB)</span>
                <span class="help-text">Rotate logs after this size.</span>
             </div>
             <input id="setting-log-size" type="number" min="1" value="10" />
          </label>
        </div>

        <h3>S3 Storage Configuration</h3>
        <div class="settings-group">
          <label class="checkbox">
            <input id="setting-seaweed-enabled" type="checkbox" checked />
            <span>Enable S3 Storage</span>
          </label>

          <label>
            <div class="label-row">
              <span>Provider</span>
              <span class="help-text">Select S3 compatible storage provider.</span>
            </div>
            <select id="setting-s3-provider">
              <option value="seaweedfs">SeaweedFS (Bundled)</option>
            </select>
          </label>

          <label>
            <div class="label-row">
              <span>S3 Port</span>
              <span class="help-text">Localhost port for S3 gateway.</span>
            </div>
            <input id="setting-seaweed-port" type="number" min="1" max="65535" />
          </label>
        </div>

        <div class="footer">
          <button id="btn-suggest">Suggest ports</button>
          <button id="btn-save" class="primary">Save Configuration</button>
        </div>
      </section>

      <!-- STATUS -->
      <section id="view-status" class="card view-page hidden">
        <h2>System Status</h2>
        <div id="status-body" class="kv-table"></div>

        <h3>Links</h3>
        <div id="links-body" class="kv-table">
            <!-- Dynamic -->
        </div>

        <h3>Installation</h3>
        <div class="kv-table">
            <div class="kv-key">Install Directory</div>
            <div class="kv-val" id="val-install-dir">-</div>
            <div class="kv-actions">
                <button class="icon-btn" onclick="copyText(document.getElementById('val-install-dir').innerText)">Copy</button>
                <button class="icon-btn" onclick="openPath(document.getElementById('val-install-dir').innerText)">Open</button>
            </div>

            <div class="kv-key">Data Directory</div>
            <div class="kv-val" id="val-data-dir">-</div>
             <div class="kv-actions">
                <button class="icon-btn" onclick="copyText(document.getElementById('val-data-dir').innerText)">Copy</button>
                <button class="icon-btn" onclick="openPath(document.getElementById('val-data-dir').innerText)">Open</button>
            </div>
            
            <div class="kv-key">Install Token</div>
            <div class="kv-val"><input id="token" type="text" readonly style="border:none; background:transparent; font-family:monospace; width:100%; color:inherit;" /></div>
            <div class="kv-actions">
                <button class="icon-btn" id="btn-copy-token">Copy</button>
            </div>
        </div>
        
        <h3>Exit Preferences</h3>
           <p class="muted">Use the tray menu <b>Exit</b> to fully quit FaceForge Desktop.</p>
      </section>
    </main>
    
    <!-- LOGS DRAWER -->
    <footer id="logs-drawer" class="logs-drawer collapsed">
        <div class="logs-header">
            <span style="font-weight:600">Core Logs (tail)</span>
            <div style="display:flex; gap:10px; align-items:center;">
               <label style="display:flex;gap:4px;cursor:pointer"><input type="checkbox" id="logs-auto-scroll" checked> Auto-scroll</label>
               <button id="btn-refresh-logs" class="icon-btn">Refresh</button>
               <button id="btn-close-logs" class="icon-btn">Close</button>
            </div>
        </div>
        <div id="logs-viewer" class="logs-viewer">Waiting for logs...</div>
    </footer>

    <!-- MODALS -->
    <div id="modal-confirm" class="modal hidden">
        <div class="modal-card">
            <h3>Restart Required</h3>
            <p>Saving these settings will restart the Core service. Continue?</p>
            <div class="footer">
                <button id="btn-modal-cancel">Cancel</button>
                <button id="btn-modal-confirm" class="primary">Restart & Save</button>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
  </body>
</html>
