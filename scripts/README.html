<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scripts</title>
    <base href="file:///A:/Code/faceforge/scripts/">
    <link rel="stylesheet" href="file:///A:/Code/faceforge/brand/fonts/fonts.css">
    <style>:root { color-scheme: light dark; }
    body { max-width: 920px; margin: 40px auto; padding: 0 16px; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height: 1.55; }
    code, pre { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    pre { padding: 12px 14px; overflow-x: auto; border: 1px solid rgba(127,127,127,.35); border-radius: 8px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid rgba(127,127,127,.35); padding: 6px 8px; }
    blockquote { margin: 0; padding-left: 14px; border-left: 4px solid rgba(127,127,127,.35); }
    img { max-width: 100%; height: auto; }</style>
</head>
<body>
<h1 id="scripts">Scripts</h1>
<h2 id="_ensure-venvps1">_ensure-venv.ps1</h2>
<h3 id="name">NAME</h3>
<pre><code>A:\Code\faceforge\scripts\_ensure-venv.ps1
</code></pre>
<h3 id="synopsis">SYNOPSIS</h3>
<pre><code>Helper utilities for FaceForge PowerShell scripts.
</code></pre>
<h3 id="syntax">SYNTAX</h3>
<pre><code class="language-text">    A:\Code\faceforge\scripts\_ensure-venv.ps1 [&lt;CommonParameters&gt;]

</code></pre>
<h3 id="description">DESCRIPTION</h3>
<pre><code>This file is intended to be dot-sourced by other scripts in the `scripts/` directory.
It provides shared helpers for:
    - Resolving the repository root.
    - Creating and locating the repo-local Python virtual environment (`.venv`).
    - Returning the correct `.venv` Python executable path for downstream scripts.

Design goals:
    - Never depend on global Python packages at runtime.
    - Prefer the Windows `py` launcher to bootstrap Python 3.12 venv creation.
    - Make failures actionable with clear error messages.
</code></pre>
<h3 id="parameters">PARAMETERS</h3>
<pre><code>&lt;CommonParameters&gt;
    This cmdlet supports the common parameters: Verbose, Debug,
    ErrorAction, ErrorVariable, WarningAction, WarningVariable,
    OutBuffer, PipelineVariable, and OutVariable. For more information, see
    about_CommonParameters (https://go.microsoft.com/fwlink/?LinkID=113216).
</code></pre>
<h3 id="inputs">INPUTS</h3>
<h3 id="outputs">OUTPUTS</h3>
<h3 id="notes">NOTES</h3>
<pre><code>    This file defines functions and does not execute any build/run tasks on its own.
    Usage pattern:
        . (Join-Path $PSScriptRoot '_ensure-venv.ps1')
        $repoRoot = Get-RepoRoot
        $venvPython = Ensure-Venv -RepoRoot $repoRoot
</code></pre>
<h3 id="related-links">RELATED LINKS</h3>
<h2 id="build-coreps1">build-core.ps1</h2>
<h3 id="name_1">NAME</h3>
<pre><code>A:\Code\faceforge\scripts\build-core.ps1
</code></pre>
<h3 id="synopsis_1">SYNOPSIS</h3>
<pre><code>Builds the FaceForge Core executable for local bundling and releases.
</code></pre>
<h3 id="syntax_1">SYNTAX</h3>
<pre><code class="language-text">    A:\Code\faceforge\scripts\build-core.ps1 [-KeepBuildHistory] [-AllowTimestampFallback] [&lt;CommonParameters&gt;]

</code></pre>
<h3 id="description_1">DESCRIPTION</h3>
<pre><code>Produces a Windows executable for FaceForge Core using PyInstaller, using the repo-local
virtual environment under `.venv`.

This script is designed to be safe and repeatable:
- Uses a repo-local venv (never relies on global site-packages after bootstrapping).
- Cleans previous `core/build` and `core/dist` output directories.
- When requested, falls back to timestamped output folders if directories are locked.
- Normalizes output to a stable path `core/dist/faceforge-core.exe` for downstream scripts.

Intended consumers:
- Local developers running the Desktop orchestrator.
- CI pipelines producing release artifacts.
- The all-in-one desktop bundler script (`scripts/build-desktop.ps1`).
</code></pre>
<h3 id="parameters_1">PARAMETERS</h3>
<pre><code>-KeepBuildHistory [&lt;SwitchParameter&gt;]
    Preserves older timestamped output folders (e.g. `core/build-YYYYMMDD-HHMMSS`, `core/dist-...`).
    By default, old timestamped output folders are pruned to keep the repo tidy.

    Required?                    false
    Position?                    named
    Default value                False
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

-AllowTimestampFallback [&lt;SwitchParameter&gt;]
    If `core/build` or `core/dist` cannot be deleted (e.g. open file handles from Explorer or a
    terminal with CWD inside those folders), the default behavior is to fail with a helpful message.
    When this switch is provided, the script will instead build into timestamped folders.

    Required?                    false
    Position?                    named
    Default value                False
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

&lt;CommonParameters&gt;
    This cmdlet supports the common parameters: Verbose, Debug,
    ErrorAction, ErrorVariable, WarningAction, WarningVariable,
    OutBuffer, PipelineVariable, and OutVariable. For more information, see
    about_CommonParameters (https://go.microsoft.com/fwlink/?LinkID=113216).
</code></pre>
<h3 id="inputs_1">INPUTS</h3>
<h3 id="outputs_1">OUTPUTS</h3>
<pre><code>On success, you will have:
  - `core/dist/faceforge-core.exe`
</code></pre>
<h3 id="notes_1">NOTES</h3>
<pre><code>    Prerequisites:
      - Python 3.12.x installed (only needed to bootstrap `.venv` the first time).
      - Build dependencies are installed into `.venv` automatically.
    This script intentionally disables confirmation prompts for non-interactive execution.

-------------------------- EXAMPLE 1 --------------------------

PS &gt; ./scripts/build-core.ps1
Builds Core into `core/dist/faceforge-core.exe`, cleaning old outputs.

-------------------------- EXAMPLE 2 --------------------------

PS &gt; ./scripts/build-core.ps1 -AllowTimestampFallback
Builds Core even if `core/dist` is locked, by using timestamped folders.
</code></pre>
<h3 id="related-links_1">RELATED LINKS</h3>
<h2 id="build-desktopps1">build-desktop.ps1</h2>
<h3 id="name_2">NAME</h3>
<pre><code>A:\Code\faceforge\scripts\build-desktop.ps1
</code></pre>
<h3 id="synopsis_2">SYNOPSIS</h3>
<pre><code>Builds a full FaceForge Desktop bundle (Desktop + Core sidecar).
</code></pre>
<h3 id="syntax_2">SYNTAX</h3>
<pre><code class="language-text">    A:\Code\faceforge\scripts\build-desktop.ps1 [-Bundles &lt;String&gt;] [-SkipCoreBuild] [-KeepBuildHistory] [-AllowTimestampFallback] [&lt;CommonParameters&gt;]

</code></pre>
<h3 id="description_2">DESCRIPTION</h3>
<pre><code>This script follows the project’s packaging intent:
  - Build FaceForge Core as a standalone executable (PyInstaller)
  - Stage it into Desktop’s Tauri sidecar binaries folder
  - Produce Desktop installers via `tauri build`

This script is designed for repeatable local and CI builds:
  - Uses the repo-local `.venv` for Core builds (never global site-packages).
  - Stages the Core sidecar into `desktop/src-tauri/binaries/faceforge-core.exe`.
  - Runs `cargo tauri build` to produce installable artifacts.

Prerequisites (Windows):
  - Rust toolchain installed (cargo).
  - Tauri prerequisites (WebView2, bundler toolchains). Tauri will prompt/download some tooling.

Outputs (Windows):
  - desktop/src-tauri/target/release/bundle/msi/*.msi
  - desktop/src-tauri/target/release/bundle/nsis/*-setup.exe
</code></pre>
<h3 id="parameters_2">PARAMETERS</h3>
<pre><code>-Bundles &lt;String&gt;
    Which bundle target(s) to build. Allowed values: all, msi, nsis.
    Default: all.

    Required?                    false
    Position?                    named
    Default value                all
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

-SkipCoreBuild [&lt;SwitchParameter&gt;]
    Skip running scripts/build-core.ps1 (expects core/dist/faceforge-core.exe to already exist).

    Required?                    false
    Position?                    named
    Default value                False
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

-KeepBuildHistory [&lt;SwitchParameter&gt;]
    Forwarded to scripts/build-core.ps1; preserves old build/dist folders under core/.

    Required?                    false
    Position?                    named
    Default value                False
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

-AllowTimestampFallback [&lt;SwitchParameter&gt;]
    Forwarded to scripts/build-core.ps1; if core/build or core/dist are locked, build into timestamped folders.

    Required?                    false
    Position?                    named
    Default value                False
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

&lt;CommonParameters&gt;
    This cmdlet supports the common parameters: Verbose, Debug,
    ErrorAction, ErrorVariable, WarningAction, WarningVariable,
    OutBuffer, PipelineVariable, and OutVariable. For more information, see
    about_CommonParameters (https://go.microsoft.com/fwlink/?LinkID=113216).
</code></pre>
<h3 id="inputs_2">INPUTS</h3>
<h3 id="outputs_2">OUTPUTS</h3>
<h3 id="notes_2">NOTES</h3>
<pre><code>    Outputs (Windows):
      - desktop/src-tauri/target/release/bundle/msi/*.msi
      - desktop/src-tauri/target/release/bundle/nsis/*-setup.exe

    This script sets `PositionalBinding = $false` to discourage ambiguous invocation.

-------------------------- EXAMPLE 1 --------------------------

PS &gt; ./scripts/build-desktop.ps1
Builds Core + Desktop, producing both MSI and NSIS artifacts.

-------------------------- EXAMPLE 2 --------------------------

PS &gt; ./scripts/build-desktop.ps1 -Bundles nsis
Builds only the NSIS installer.

-------------------------- EXAMPLE 3 --------------------------

PS &gt; ./scripts/build-desktop.ps1 -SkipCoreBuild -Bundles msi
Fast path when nothing changed in Core.
</code></pre>
<h3 id="related-links_2">RELATED LINKS</h3>
<h2 id="check-coreps1">check-core.ps1</h2>
<h3 id="name_3">NAME</h3>
<pre><code>A:\Code\faceforge\scripts\check-core.ps1
</code></pre>
<h3 id="synopsis_3">SYNOPSIS</h3>
<pre><code>Runs FaceForge Core quality gates (format, lint, tests).
</code></pre>
<h3 id="syntax_3">SYNTAX</h3>
<pre><code class="language-text">    A:\Code\faceforge\scripts\check-core.ps1 [&lt;CommonParameters&gt;]

</code></pre>
<h3 id="description_3">DESCRIPTION</h3>
<pre><code>Installs FaceForge Core in editable mode with development dependencies into the repo-local
virtual environment (`.venv`), then runs:
  - ruff format --check
  - ruff check
  - pytest

This is intended for local verification and CI usage. It will stop on the first failure and
return a non-zero exit code.
</code></pre>
<h3 id="parameters_3">PARAMETERS</h3>
<pre><code>&lt;CommonParameters&gt;
    This cmdlet supports the common parameters: Verbose, Debug,
    ErrorAction, ErrorVariable, WarningAction, WarningVariable,
    OutBuffer, PipelineVariable, and OutVariable. For more information, see
    about_CommonParameters (https://go.microsoft.com/fwlink/?LinkID=113216).
</code></pre>
<h3 id="inputs_3">INPUTS</h3>
<h3 id="outputs_3">OUTPUTS</h3>
<pre><code>Console output from tooling. Exits non-zero on failure.
</code></pre>
<h3 id="notes_3">NOTES</h3>
<pre><code>    Prerequisites:
      - Python 3.12.x is recommended (used only to bootstrap `.venv` on first run).
    This script does not rely on global Python packaging once `.venv` exists.

-------------------------- EXAMPLE 1 --------------------------

PS &gt; ./scripts/check-core.ps1
Runs format, lint, and tests.
</code></pre>
<h3 id="related-links_3">RELATED LINKS</h3>
<h2 id="dev-coreps1">dev-core.ps1</h2>
<h3 id="name_4">NAME</h3>
<pre><code>A:\Code\faceforge\scripts\dev-core.ps1
</code></pre>
<h3 id="synopsis_4">SYNOPSIS</h3>
<pre><code>Runs FaceForge Core locally in development mode.
</code></pre>
<h3 id="syntax_4">SYNTAX</h3>
<pre><code class="language-text">    A:\Code\faceforge\scripts\dev-core.ps1 [&lt;CommonParameters&gt;]

</code></pre>
<h3 id="description_4">DESCRIPTION</h3>
<pre><code>Bootstraps the repo-local virtual environment (`.venv`) if needed, installs FaceForge Core
in editable mode with development dependencies, then launches the Core server.

Environment variables (optional):
  - FACEFORGE_BIND: bind host for Uvicorn/FastAPI (default: 127.0.0.1)
  - FACEFORGE_PORT: bind port for Core (default: 8787)

This script is intended for local development. For Desktop orchestration, run the Tauri app
and let it start Core.
</code></pre>
<h3 id="parameters_4">PARAMETERS</h3>
<pre><code>&lt;CommonParameters&gt;
    This cmdlet supports the common parameters: Verbose, Debug,
    ErrorAction, ErrorVariable, WarningAction, WarningVariable,
    OutBuffer, PipelineVariable, and OutVariable. For more information, see
    about_CommonParameters (https://go.microsoft.com/fwlink/?LinkID=113216).
</code></pre>
<h3 id="inputs_4">INPUTS</h3>
<h3 id="outputs_4">OUTPUTS</h3>
<h3 id="notes_4">NOTES</h3>
<pre><code>    This script intentionally uses `.venv\Scripts\python.exe` for all Python execution.
    External command failures (pip install, server start) cause the script to fail fast.

-------------------------- EXAMPLE 1 --------------------------

PS &gt; ./scripts/dev-core.ps1
Starts Core at http://127.0.0.1:8787

-------------------------- EXAMPLE 2 --------------------------

PS &gt; $env:FACEFORGE_PORT = '43210'
./scripts/dev-core.ps1
Starts Core at http://127.0.0.1:43210
</code></pre>
<h3 id="related-links_4">RELATED LINKS</h3>
<h2 id="set-versionps1">set-version.ps1</h2>
<h3 id="name_5">NAME</h3>
<pre><code>A:\Code\faceforge\scripts\set-version.ps1
</code></pre>
<h3 id="synopsis_5">SYNOPSIS</h3>
<pre><code>Bumps FaceForge version across Core + Desktop manifests.
</code></pre>
<h3 id="syntax_5">SYNTAX</h3>
<pre><code class="language-text">    A:\Code\faceforge\scripts\set-version.ps1 -Version &lt;String&gt; [-WhatIf] [-Confirm] [&lt;CommonParameters&gt;]

</code></pre>
<h3 id="description_5">DESCRIPTION</h3>
<pre><code>Updates version strings in the following files:
  - core/pyproject.toml
  - core/src/faceforge_core/app.py
  - desktop/src-tauri/Cargo.toml
- desktop/src-tauri/Cargo.lock
  - desktop/src-tauri/tauri.conf.json

The script supports -WhatIf / -Confirm for safe previews.
</code></pre>
<h3 id="parameters_5">PARAMETERS</h3>
<pre><code>-Version &lt;String&gt;
    The semantic version to set (e.g. 0.1.2).

    Required?                    true
    Position?                    named
    Default value
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

-WhatIf [&lt;SwitchParameter&gt;]

    Required?                    false
    Position?                    named
    Default value
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

-Confirm [&lt;SwitchParameter&gt;]

    Required?                    false
    Position?                    named
    Default value
    Accept pipeline input?       false
    Aliases
    Accept wildcard characters?  false

&lt;CommonParameters&gt;
    This cmdlet supports the common parameters: Verbose, Debug,
    ErrorAction, ErrorVariable, WarningAction, WarningVariable,
    OutBuffer, PipelineVariable, and OutVariable. For more information, see
    about_CommonParameters (https://go.microsoft.com/fwlink/?LinkID=113216).
</code></pre>
<h3 id="inputs_5">INPUTS</h3>
<h3 id="outputs_5">OUTPUTS</h3>
<h3 id="notes_5">NOTES</h3>
<pre><code>    If a target file or pattern is not found, the script emits a warning and continues.

-------------------------- EXAMPLE 1 --------------------------

PS &gt; ./scripts/set-version.ps1 -Version 0.1.2
Updates all known manifests to 0.1.2.

-------------------------- EXAMPLE 2 --------------------------

PS &gt; ./scripts/set-version.ps1 -Version 0.1.2 -WhatIf
Shows what would change without modifying files.
</code></pre>
<h3 id="related-links_5">RELATED LINKS</h3>
<h2 id="update-docsps1">update-docs.ps1</h2>
<p>update-docs.ps1 [-ConfigPath <string>] [-Force] [-SkipScriptsReadme] [-WhatIf] [-Confirm] [<CommonParameters>]</p>
</body>
</html>
